# v4.11.0 第三优先级优化计划

## 🎯 优化目标

实现三个核心决策辅助功能，帮助用户：
1. 验证策略有效性（历史表现追踪）
2. 把握市场节奏（市场情绪指数）
3. 提高交易纪律（智能止盈止损提醒）

---

## ✅ 优化7：历史表现追踪

### 功能描述
- **记录推荐历史**：
  - 每次筛选后自动保存推荐的股票
  - 记录推荐时的价格、涨幅、量比等关键数据
  - 保存推荐时间和筛选条件

- **追踪后续表现**：
  - 3天后自动查询股票表现
  - 计算实际涨跌幅
  - 标记成功/失败（目标+5%）

- **统计分析**：
  - 计算策略胜率（成功率）
  - 计算平均收益率
  - 显示最佳/最差表现

- **可视化展示**：
  - 历史推荐列表（最近10次）
  - 每次推荐的详细表现
  - 胜率和收益趋势图

### 效果展示
```
┌─────────────────────────────────────────────┐
│ 📊 历史表现追踪                              │
├─────────────────────────────────────────────┤
│ 策略统计（最近30天）                         │
│ 胜率：68.2% (15/22)                         │
│ 平均收益：+3.8%                             │
│ 最佳表现：+12.5% (华民股份)                 │
│ 最差表现：-3.2% (宏柏新材)                  │
├─────────────────────────────────────────────┤
│ 最近推荐回顾                                 │
│ ┌─────────────────────────────────────────┐ │
│ │ 2026-02-06 推荐                         │ │
│ │ 宏柏新材 ¥7.50 → 3天后 ¥8.14 +8.5% ✅  │ │
│ │ 鑫铂股份 ¥6.80 → 3天后 ¥6.94 +2.1% ✅  │ │
│ │ 华民股份 ¥7.68 → 3天后 ¥7.59 -1.2% ❌  │ │
│ │ 本次胜率：66.7%  平均收益：+3.1%       │ │
│ └─────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────┐ │
│ │ 2026-02-05 推荐                         │ │
│ │ ...                                     │ │
│ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────┘
```

### 技术实现
```typescript
// localStorage.ts
export interface TrackingRecord {
  id: string;
  date: string;
  stocks: {
    code: string;
    name: string;
    buyPrice: number;
    change: number;
    ratio: number;
  }[];
  performance?: {
    code: string;
    afterPrice: number;
    afterChange: number;
    profit: number;
    success: boolean;
  }[];
  winRate?: number;
  avgProfit?: number;
}

export function addTrackingRecord(stocks: any[]): void
export function getTrackingHistory(limit: number = 10): TrackingRecord[]
export function updateTrackingPerformance(id: string, performance: any[]): void
```

### 价值
- ✅ 验证策略有效性，建立信心
- ✅ 发现问题，持续改进
- ✅ 量化投资效果

---

## ✅ 优化8：市场情绪指数

### 功能描述
- **多维度情绪分析**：
  - 涨跌家数比（上涨/下跌股票数量）
  - 成交量变化（相比昨日）
  - 涨停/跌停数量
  - 两市总成交额

- **情绪等级划分**：
  - 😱 极度恐慌（0-20分）
  - 😰 恐慌（20-40分）
  - 😐 中性（40-60分）
  - 😊 乐观（60-80分）
  - 🤩 极度乐观（80-100分）

- **操作建议**：
  - 极度恐慌：🟢 重仓机会（贪婪时刻）
  - 恐慌：🟢 正常建仓
  - 中性：🟡 谨慎操作
  - 乐观：🟠 减仓观望
  - 极度乐观：🔴 空仓避险（恐惧时刻）

- **历史对比**：
  - 显示近5日情绪趋势
  - 识别情绪拐点
  - 提示反转信号

### 效果展示
```
┌─────────────────────────────────────────────┐
│ 🎭 市场情绪指数                              │
├─────────────────────────────────────────────┤
│                                              │
│                    72                        │
│                   😊 乐观                    │
│                                              │
├─────────────────────────────────────────────┤
│ 情绪指标                                     │
│ 涨跌比：2.3:1 (2300↑ / 1000↓)              │
│ 成交量：+15% vs 昨日                        │
│ 涨停数：45只  跌停数：3只                   │
│ 总成交额：8,500亿                           │
├─────────────────────────────────────────────┤
│ 操作建议                                     │
│ 🟠 建议减仓观望                              │
│ 市场情绪偏热，注意回调风险。建议降低仓位至  │
│ 50-60%，保留现金应对可能的调整。            │
├─────────────────────────────────────────────┤
│ 近5日趋势                                    │
│ 02-03: 45 😐  02-04: 52 😐  02-05: 68 😊   │
│ 02-06: 75 😊  02-07: 72 😊                  │
│ 💡 情绪持续高位，警惕回调                   │
└─────────────────────────────────────────────┘
```

### 技术实现
```typescript
// 情绪指数计算
const emotionScore = (
  riseRatio * 0.4 +        // 涨跌比权重40%
  volumeChange * 0.3 +     // 成交量权重30%
  limitUpRatio * 0.2 +     // 涨停比权重20%
  turnoverScore * 0.1      // 成交额权重10%
);

// 情绪等级
const emotionLevel = 
  score < 20 ? 'panic_extreme' :
  score < 40 ? 'panic' :
  score < 60 ? 'neutral' :
  score < 80 ? 'optimistic' : 'optimistic_extreme';
```

### 价值
- ✅ 把握市场节奏，顺势而为
- ✅ 避免追高杀跌
- ✅ 提高胜率

---

## ✅ 优化9：智能止盈止损提醒

### 功能描述
- **自动生成交易计划**：
  - 基于当前价格计算止损价（-5%）
  - 基于当前价格计算目标价（+5%~+8%）
  - 根据量比和涨幅调整目标价
  - 建议持有期（3-5天）

- **风险收益比**：
  - 计算风险收益比（1:1 或 1:1.5）
  - 评估交易价值
  - 给出明确建议

- **动态调整**：
  - 盈利>3%后，止损位上移至成本价
  - 盈利>5%后，止损位上移至+3%
  - 移动止损，保护利润

- **提醒功能**：
  - 显示距离止损价的距离
  - 显示距离目标价的距离
  - 用颜色标识风险程度

### 效果展示
```
┌─────────────────────────────────────────────┐
│ 💡 智能交易计划                              │
├─────────────────────────────────────────────┤
│ 宏柏新材 (605366)                            │
│ ┌─────────────────────────────────────────┐ │
│ │ 买入价：¥7.50                           │ │
│ │ 止损价：¥7.13 (-5%)  距离：-4.9%       │ │
│ │ 目标价：¥7.88 (+5%)  距离：+0.5%       │ │
│ │ 持有期：3-5天                           │ │
│ │ 风险收益比：1:1                         │ │
│ └─────────────────────────────────────────┘ │
│ 📊 当前状态：接近目标价 🟢                   │
│ 💡 建议：可考虑止盈，或上移止损至成本价      │
├─────────────────────────────────────────────┤
│ 鑫铂股份 (003038)                            │
│ ┌─────────────────────────────────────────┐ │
│ │ 买入价：¥6.80                           │ │
│ │ 止损价：¥6.46 (-5%)  距离：-5.0%       │ │
│ │ 目标价：¥7.34 (+8%)  距离：+7.9%       │ │
│ │ 持有期：3-5天                           │ │
│ │ 风险收益比：1:1.6                       │ │
│ └─────────────────────────────────────────┘ │
│ 📊 当前状态：正常持有 🟡                     │
│ 💡 建议：继续持有，严格执行止损              │
├─────────────────────────────────────────────┤
│ 华民股份 (300345)                            │
│ ┌─────────────────────────────────────────┐ │
│ │ 买入价：¥7.68                           │ │
│ │ 止损价：¥7.30 (-5%)  距离：-4.9%       │ │
│ │ 目标价：¥8.07 (+5%)  距离：+5.1%       │ │
│ │ 持有期：3-5天                           │ │
│ │ 风险收益比：1:1                         │ │
│ └─────────────────────────────────────────┘ │
│ 📊 当前状态：正常持有 🟡                     │
│ 💡 建议：继续持有，关注止损位                │
└─────────────────────────────────────────────┘
```

### 技术实现
```typescript
// 交易计划生成
export interface TradingPlan {
  code: string;
  name: string;
  buyPrice: number;
  stopLoss: number;      // 止损价
  targetPrice: number;   // 目标价
  holdDays: string;      // 持有期
  riskRewardRatio: string; // 风险收益比
  currentStatus: 'approaching_target' | 'normal' | 'approaching_stop';
  suggestion: string;
}

export function generateTradingPlan(stock: any): TradingPlan {
  const buyPrice = stock.price;
  const stopLoss = buyPrice * 0.95;  // -5%
  
  // 根据量比和涨幅调整目标价
  let targetPercent = 0.05;  // 默认+5%
  if (stock.volume_ratio > 2 && stock.change_percent > 3) {
    targetPercent = 0.08;  // 强势股+8%
  }
  
  const targetPrice = buyPrice * (1 + targetPercent);
  const riskRewardRatio = `1:${(targetPercent / 0.05).toFixed(1)}`;
  
  return {
    code: stock.code,
    name: stock.name,
    buyPrice,
    stopLoss,
    targetPrice,
    holdDays: '3-5天',
    riskRewardRatio,
    currentStatus: 'normal',
    suggestion: '继续持有，严格执行止损'
  };
}
```

### 价值
- ✅ 提高交易纪律性
- ✅ 避免情绪化操作
- ✅ 保护利润，控制风险

---

## 🎨 界面布局

```
┌─────────────────────────────────────────────────────────┐
│  📊 筛选结果统计                                         │
│  [🟢 刚刚更新]  共 3 只股票                              │
└─────────────────────────────────────────────────────────┘

┌──────────────┬──────────────┬──────────────────────────┐
│ 🏛️ 板块分布  │ 🏭 行业分布  │ 🎯 风险分散评分          │
│ 🔄 板块轮动  │ 🔥 行业热度  │        95                │
└──────────────┴──────────────┴──────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  🎭 市场情绪指数                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │        72 😊 乐观                                │   │
│  │  🟠 建议减仓观望                                 │   │
│  │  市场情绪偏热，注意回调风险                      │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  💡 智能交易计划                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 宏柏新材 买入¥7.50 止损¥7.13 目标¥7.88        │   │
│  │ 📊 接近目标价 🟢 可考虑止盈                     │   │
│  └─────────────────────────────────────────────────┘   │
│  ...                                                     │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  📊 历史表现追踪                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 策略统计：胜率 68.2%  平均收益 +3.8%           │   │
│  │ 最近推荐：2026-02-06                            │   │
│  │ 宏柏新材 +8.5% ✅  鑫铂股份 +2.1% ✅           │   │
│  │ 华民股份 -1.2% ❌  本次胜率 66.7%              │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  📋 初步筛选结果                    [⚖️ 快速对比]       │
│  ...                                                     │
└─────────────────────────────────────────────────────────┘
```

---

## 📈 实现步骤

### 步骤1：扩展localStorage（30分钟）
- 添加历史追踪数据结构
- 添加市场情绪数据结构
- 添加交易计划数据结构

### 步骤2：实现历史表现追踪（45分钟）
- 保存推荐记录
- 追踪后续表现（模拟数据）
- 计算统计指标
- 显示历史列表

### 步骤3：实现市场情绪指数（45分钟）
- 计算情绪指数（基于筛选结果）
- 显示情绪等级
- 给出操作建议
- 显示历史趋势

### 步骤4：实现智能交易计划（45分钟）
- 生成交易计划
- 计算止损止盈价
- 显示当前状态
- 给出操作建议

### 步骤5：界面集成和测试（30分钟）
- 集成到主界面
- 调整布局
- 测试功能
- 优化样式

**总计时间**：约3小时

---

## 💡 核心价值

v4.11.0 新增三大决策辅助功能：
1. ✅ **历史表现追踪**（验证策略，建立信心）
2. ✅ **市场情绪指数**（把握节奏，顺势而为）
3. ✅ **智能交易计划**（提高纪律，控制风险）

**核心价值**：
1. **策略验证**：通过历史数据验证策略有效性
2. **市场把握**：通过情绪指数把握市场节奏
3. **纪律执行**：通过交易计划提高执行力

**适用场景**：
- ✅ 验证投资策略
- ✅ 判断市场时机
- ✅ 制定交易计划
- ✅ 提高投资纪律

这将是一个质的飞跃！🎉
