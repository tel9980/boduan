# v4.15.4 更新说明

## 📝 更新内容

### 缓存策略调整
根据用户反馈，将自动刷新间隔从 **5分钟** 调整为 **30分钟**

---

## 🔄 具体修改

### 1. 缓存有效期
- **修改前**: 5分钟
- **修改后**: 30分钟
- **影响**: 30分钟内点击任何策略都使用缓存，无需重新筛选

### 2. 自动刷新间隔
- **修改前**: 每5分钟刷新一次
- **修改后**: 每30分钟刷新一次
- **影响**: 减少服务器负载，降低API调用频率

---

## 📊 性能影响

### 优点
1. ✅ **降低服务器负载**: API调用频率降低6倍
2. ✅ **减少AI调用**: GLM API调用次数大幅减少
3. ✅ **节省资源**: CPU和网络资源占用更少
4. ✅ **更稳定**: 减少因频繁调用导致的API限流风险

### 缺点
1. ⚠️ **数据新鲜度**: 缓存数据最多可能延迟30分钟
2. ⚠️ **市场变化**: 快速变化的市场行情可能不够及时

### 权衡
对于股票筛选系统来说，30分钟的延迟是可以接受的：
- 波段交易不需要秒级更新
- 筛选结果主要用于参考，不是实时交易
- 用户可以手动清空缓存强制刷新

---

## 🎯 使用建议

### 日常使用
- 使用极速版启动脚本
- 保持自动刷新服务运行
- 30分钟内的数据足够新鲜

### 需要最新数据时
```bash
# 方式1: 访问API清空缓存
http://localhost:8000/api/cache/clear

# 方式2: 删除缓存文件
del backend\cache\*.json

# 方式3: 重启自动预热服务
# 关闭当前服务，重新运行
python backend/auto_preheat.py
```

### 市场剧烈波动时
- 建议手动清空缓存
- 或者等待下一次自动刷新（最多30分钟）
- 或者临时调整刷新间隔（修改代码）

---

## 🔧 如何调整刷新间隔

如果你想自定义刷新间隔，可以修改以下文件：

### 1. 修改自动刷新间隔
```python
# backend/auto_preheat.py
# 找到这一行：
schedule.every(30).minutes.do(preheat_all_strategies)

# 修改为你想要的间隔，例如：
schedule.every(15).minutes.do(preheat_all_strategies)  # 15分钟
schedule.every(60).minutes.do(preheat_all_strategies)  # 60分钟
```

### 2. 修改缓存有效期
```python
# backend/main.py
# 找到这一行：
if age_minutes < 30:  # 30分钟内使用缓存

# 修改为你想要的有效期，例如：
if age_minutes < 15:  # 15分钟内使用缓存
if age_minutes < 60:  # 60分钟内使用缓存
```

**注意**: 两个值应该保持一致，否则可能出现缓存失效但未刷新的情况

---

## 📈 推荐配置

根据不同使用场景，推荐以下配置：

### 场景1: 日内交易（需要较新数据）
- 缓存有效期: 10分钟
- 自动刷新间隔: 10分钟
- 适合: 短线交易、日内波段

### 场景2: 波段交易（平衡性能和新鲜度）
- 缓存有效期: 30分钟 ✅ **当前配置**
- 自动刷新间隔: 30分钟
- 适合: 中短线波段、日常筛选

### 场景3: 长线投资（注重性能）
- 缓存有效期: 60分钟
- 自动刷新间隔: 60分钟
- 适合: 长线投资、基本面分析

---

## 🔍 监控缓存状态

### 查看缓存文件
```bash
# 查看缓存目录
dir backend\cache

# 查看缓存文件修改时间
dir backend\cache /T:W
```

### 查看后端日志
后端窗口会显示缓存使用情况：
```
✅ 使用缓存数据（15.3分钟前，策略：balanced）
```

### 查看自动刷新日志
自动预热服务窗口会显示刷新记录：
```
🔄 开始预热缓存 - 2026-02-08 14:30:00
✅ 平衡型缓存生成成功！耗时：3.2分钟
✅ 激进型缓存生成成功！耗时：3.5分钟
✅ 保守型缓存生成成功！耗时：3.8分钟
✅ 缓存预热完成 - 2026-02-08 14:40:35
```

---

## ⚠️ 注意事项

### 1. 首次启动
- 首次启动仍需等待10-12分钟预热
- 预热完成后，30分钟内都能秒开

### 2. 缓存失效
- 30分钟后缓存自动失效
- 自动刷新服务会在失效前刷新
- 如果自动刷新服务未运行，用户点击时会重新筛选（2.5-3.5分钟）

### 3. 手动清空缓存
- 清空缓存后，下次点击需要重新筛选
- 建议在非交易时间清空缓存
- 或者等待自动刷新

### 4. API限流
- 30分钟间隔大幅降低API调用频率
- 减少被限流的风险
- 更稳定可靠

---

## 📞 反馈与建议

如果你觉得30分钟的间隔：
- **太长**: 可以改为15分钟或20分钟
- **太短**: 可以改为45分钟或60分钟
- **刚好**: 保持当前配置

根据实际使用情况调整即可！

---

## 🎉 总结

### 主要变化
- 缓存有效期: 5分钟 → 30分钟
- 自动刷新间隔: 5分钟 → 30分钟

### 优势
- ✅ 降低服务器负载
- ✅ 减少API调用
- ✅ 更稳定可靠
- ✅ 节省资源

### 适用场景
- ✅ 波段交易
- ✅ 日常筛选
- ✅ 中长线投资

### 不适用场景
- ⚠️ 高频交易
- ⚠️ 秒级更新需求
- ⚠️ 实时交易决策

---

**版本**: v4.15.4  
**更新时间**: 2026-02-08  
**更新类型**: 缓存策略调整  
**影响范围**: 缓存有效期和自动刷新间隔
