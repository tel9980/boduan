# v4.7.0 板块分散优化

## 🎯 优化目标

用户反馈：筛选结果三只股票都是上海的，希望实现板块分散，包含：
- 1只沪市主板（sh6开头）
- 1只深市主板（sz0开头）
- 1只创业板（sz3开头）

## ✅ 实现方案

### 核心策略：板块分散优先

修改了 `backend/scheduler.py` 的筛选逻辑：

1. **分类收集**：按板块分别收集符合条件的股票
   - 沪市主板（sh）
   - 深市主板（sz）
   - 创业板（cyb）

2. **优先选择**：从每个板块各选1只涨幅最高的
   - 确保板块分散
   - 降低系统性风险

3. **补充机制**：如果某个板块没有符合条件的股票
   - 从其他板块补充
   - 保证总数为3只

### 代码实现

```python
# 按板块分类存储
sh_stocks = []  # 沪市主板
sz_stocks = []  # 深市主板
cyb_stocks = []  # 创业板

# 筛选并分类
for stock in all_stocks:
    # ... 筛选条件 ...
    
    # 按板块分类
    if board['type'] == 'sh':
        sh_stocks.append(stock)
    elif board['type'] == 'sz':
        sz_stocks.append(stock)
    elif board['type'] == 'cyb':
        cyb_stocks.append(stock)

# 板块分散策略：从每个板块各选1只
result = []
if sh_stocks:
    result.append(sh_stocks[0])  # 沪市最优
if sz_stocks:
    result.append(sz_stocks[0])  # 深市最优
if cyb_stocks:
    result.append(cyb_stocks[0])  # 创业板最优
```

## 📊 筛选结果示例

**时间**：2026-02-06 22:11:34

**板块分布**：
- ✅ 沪市主板 1只
- ✅ 深市主板 1只
- ✅ 创业板 1只

**具体股票**：

1. **宏柏新材 (605366)** - 沪市主板
   - 涨幅：+4.75%
   - 量比：1.94
   - 市值：48.76亿

2. **鑫铂股份 (003038)** - 深市主板
   - 涨幅：+4.78%
   - 量比：1.79
   - 市值：44.33亿

3. **华民股份 (300345)** - 创业板
   - 涨幅：+4.77%
   - 量比：1.60
   - 市值：44.56亿

## 🎯 优势分析

### 1. 风险分散
- 不同板块有不同的市场特征
- 降低单一板块系统性风险
- 提高组合稳定性

### 2. 机会均衡
- 沪市：大盘蓝筹，稳健
- 深市：中小盘，灵活
- 创业板：成长股，弹性大

### 3. 符合波段交易策略
- 3只股票来自3个不同板块
- 分散持仓，降低风险
- 提高胜率

## 📈 数据输出格式

新增 `board_distribution` 字段：

```json
{
  "timestamp": "2026-02-06T22:11:34.327452",
  "count": 3,
  "data": [...],
  "board_distribution": {
    "sh_count": 1,
    "sz_count": 1,
    "cyb_count": 1
  }
}
```

## 🔄 自动更新

- 每30分钟自动筛选一次
- 自动保持板块分散
- 无需手动干预

## 🎓 总结

通过板块分散策略，系统现在能够：
- ✅ 自动从不同板块选股
- ✅ 降低系统性风险
- ✅ 提高组合稳定性
- ✅ 符合专业投资理念

这是一个简单但非常实用的优化，完美契合波段交易策略的风险控制要求。
