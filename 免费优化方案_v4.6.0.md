# Aè‚¡æ³¢æ®µäº¤æ˜“ç­›é€‰ç³»ç»Ÿ - å…è´¹ä¼˜åŒ–æ–¹æ¡ˆ v4.6.0

## ğŸ’° é›¶æˆæœ¬ä¼˜åŒ–ç­–ç•¥

é’ˆå¯¹ä¸ªäººä½¿ç”¨åœºæ™¯ï¼Œä»¥ä¸‹æ‰€æœ‰æ–¹æ¡ˆéƒ½æ˜¯**å®Œå…¨å…è´¹**çš„ï¼

---

## ğŸ¯ ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šå…è´¹çœŸå®æ•°æ®æ¥å…¥

### æ–¹æ¡ˆä¸€ï¼šAKShareï¼ˆæ¨èï¼‰â­â­â­â­â­

**ä¼˜åŠ¿ï¼š**
- âœ… å®Œå…¨å…è´¹ï¼Œæ— éœ€æ³¨å†Œ
- âœ… æ•°æ®ä¸°å¯Œï¼Œè¦†ç›–Aè‚¡å…¨å¸‚åœº
- âœ… ç¤¾åŒºæ´»è·ƒï¼ŒæŒç»­æ›´æ–°
- âœ… å®‰è£…ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿

**å¿«é€Ÿå¼€å§‹ï¼š**

```bash
# 1. å®‰è£…AKShare
pip install akshare

# 2. æµ‹è¯•æ˜¯å¦å¯ç”¨
python -c "import akshare as ak; print(ak.__version__)"
```

**æ•°æ®æ¥å£ç¤ºä¾‹ï¼š**

```python
import akshare as ak
import pandas as pd

# 1. è·å–å®æ—¶è¡Œæƒ…æ•°æ®
def get_realtime_quotes_akshare(stock_codes: List[str]) -> pd.DataFrame:
    """
    è·å–å®æ—¶è¡Œæƒ…ï¼ˆå…è´¹ï¼‰
    """
    try:
        # AKShareè·å–å®æ—¶è¡Œæƒ…
        df = ak.stock_zh_a_spot_em()  # æ²ªæ·±Aè‚¡å®æ—¶è¡Œæƒ…
        
        # ç­›é€‰æŒ‡å®šè‚¡ç¥¨
        df = df[df['ä»£ç '].isin(stock_codes)]
        
        # å­—æ®µæ˜ å°„
        result = pd.DataFrame({
            'code': df['ä»£ç '],
            'name': df['åç§°'],
            'price': df['æœ€æ–°ä»·'],
            'change_percent': df['æ¶¨è·Œå¹…'],
            'volume': df['æˆäº¤é‡'],
            'amount': df['æˆäº¤é¢'],
            'turnover': df['æ¢æ‰‹ç‡'],
            'volume_ratio': df['é‡æ¯”'],
            'market_cap': df['æµé€šå¸‚å€¼'] / 100000000  # è½¬æ¢ä¸ºäº¿
        })
        
        return result
    except Exception as e:
        print(f"è·å–å®æ—¶è¡Œæƒ…å¤±è´¥: {e}")
        return pd.DataFrame()


# 2. è·å–èèµ„èåˆ¸æ•°æ®ï¼ˆå…è´¹ï¼‰
def get_margin_trading_akshare(stock_code: str) -> Dict[str, Any]:
    """
    è·å–èèµ„èåˆ¸æ•°æ®ï¼ˆå…è´¹ï¼‰
    """
    try:
        # ç§»é™¤å¸‚åœºå‰ç¼€
        clean_code = stock_code.replace('sh', '').replace('sz', '')
        
        # è·å–èèµ„èåˆ¸æ•°æ®
        df = ak.stock_margin_detail_sse(symbol=clean_code)  # ä¸Šäº¤æ‰€
        # æˆ–è€…
        # df = ak.stock_margin_detail_szse(symbol=clean_code)  # æ·±äº¤æ‰€
        
        if df.empty:
            return {
                'is_margin_eligible': False,
                'margin_balance': 0,
                'margin_score': 0,
                'net_flow': 0
            }
        
        # è·å–æœ€æ–°ä¸€å¤©çš„æ•°æ®
        latest = df.iloc[-1]
        
        return {
            'is_margin_eligible': True,
            'margin_balance': latest['èèµ„ä½™é¢'] / 100000000,  # è½¬æ¢ä¸ºäº¿
            'margin_buy_amount': latest['èèµ„ä¹°å…¥é¢'] / 100000000,
            'short_balance': latest['èåˆ¸ä½™é¢'],
            'margin_score': calculate_margin_score(latest),
            'net_flow': (latest['èèµ„ä¹°å…¥é¢'] - latest['èèµ„å¿è¿˜é¢']) / 100000000
        }
    except Exception as e:
        print(f"è·å–èèµ„èåˆ¸æ•°æ®å¤±è´¥ {stock_code}: {e}")
        return {
            'is_margin_eligible': False,
            'margin_balance': 0,
            'margin_score': 0,
            'net_flow': 0
        }


# 3. è·å–èµ„é‡‘æµå‘æ•°æ®ï¼ˆå…è´¹ï¼‰
def get_capital_flow_akshare(stock_code: str) -> Dict[str, Any]:
    """
    è·å–èµ„é‡‘æµå‘æ•°æ®ï¼ˆå…è´¹ï¼‰
    """
    try:
        clean_code = stock_code.replace('sh', '').replace('sz', '')
        
        # è·å–ä¸ªè‚¡èµ„é‡‘æµå‘
        df = ak.stock_individual_fund_flow_rank(symbol="å³æ—¶")
        
        # ç­›é€‰æŒ‡å®šè‚¡ç¥¨
        stock_data = df[df['ä»£ç '] == clean_code]
        
        if stock_data.empty:
            return {
                'main_inflow': 0,
                'is_inflow': False,
                'flow_strength': 'neutral'
            }
        
        main_inflow = stock_data.iloc[0]['ä¸»åŠ›å‡€æµå…¥-å‡€é¢'] / 100000000  # è½¬æ¢ä¸ºäº¿
        
        # åˆ¤æ–­æµå‘å¼ºåº¦
        if main_inflow > 1.0:
            flow_strength = 'strong_in'
        elif main_inflow > 0.4:
            flow_strength = 'weak_in'
        elif main_inflow < -1.0:
            flow_strength = 'strong_out'
        elif main_inflow < -0.4:
            flow_strength = 'weak_out'
        else:
            flow_strength = 'neutral'
        
        return {
            'main_inflow': main_inflow,
            'is_inflow': main_inflow > 0.15,
            'flow_strength': flow_strength,
            'has_data': True
        }
    except Exception as e:
        print(f"è·å–èµ„é‡‘æµå‘æ•°æ®å¤±è´¥ {stock_code}: {e}")
        return {
            'main_inflow': 0,
            'is_inflow': False,
            'flow_strength': 'neutral',
            'has_data': False
        }


# 4. è·å–Kçº¿æ•°æ®ï¼ˆå…è´¹ï¼‰
def get_kline_data_akshare(stock_code: str, period: str = 'daily', 
                           start_date: str = None, end_date: str = None) -> pd.DataFrame:
    """
    è·å–Kçº¿æ•°æ®ï¼ˆå…è´¹ï¼‰
    
    Args:
        stock_code: è‚¡ç¥¨ä»£ç 
        period: å‘¨æœŸ 'daily'(æ—¥çº¿), '5'(5åˆ†é’Ÿ), '15'(15åˆ†é’Ÿ), '30'(30åˆ†é’Ÿ), '60'(60åˆ†é’Ÿ)
        start_date: å¼€å§‹æ—¥æœŸ '20240101'
        end_date: ç»“æŸæ—¥æœŸ '20241231'
    """
    try:
        clean_code = stock_code.replace('sh', '').replace('sz', '')
        
        # è·å–æ—¥Kçº¿æ•°æ®
        if period == 'daily':
            df = ak.stock_zh_a_hist(
                symbol=clean_code,
                period="daily",
                start_date=start_date or "20240101",
                end_date=end_date or "20241231",
                adjust="qfq"  # å‰å¤æƒ
            )
        else:
            # è·å–åˆ†é’ŸKçº¿æ•°æ®
            df = ak.stock_zh_a_hist_min_em(
                symbol=clean_code,
                period=period,
                adjust="qfq"
            )
        
        # å­—æ®µæ˜ å°„
        result = pd.DataFrame({
            'date': df['æ—¥æœŸ'],
            'open': df['å¼€ç›˜'],
            'close': df['æ”¶ç›˜'],
            'high': df['æœ€é«˜'],
            'low': df['æœ€ä½'],
            'volume': df['æˆäº¤é‡']
        })
        
        return result
    except Exception as e:
        print(f"è·å–Kçº¿æ•°æ®å¤±è´¥ {stock_code}: {e}")
        return pd.DataFrame()


# 5. è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ï¼ˆå…è´¹ï¼‰
def get_stock_info_akshare(stock_code: str) -> Dict[str, Any]:
    """
    è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ï¼ˆå…è´¹ï¼‰
    """
    try:
        clean_code = stock_code.replace('sh', '').replace('sz', '')
        
        # è·å–è‚¡ç¥¨ä¿¡æ¯
        df = ak.stock_individual_info_em(symbol=clean_code)
        
        info = {}
        for _, row in df.iterrows():
            info[row['item']] = row['value']
        
        return {
            'code': stock_code,
            'name': info.get('è‚¡ç¥¨ç®€ç§°', ''),
            'industry': info.get('è¡Œä¸š', ''),
            'total_market_cap': float(info.get('æ€»å¸‚å€¼', 0)),
            'circulating_market_cap': float(info.get('æµé€šå¸‚å€¼', 0)),
            'pe_ratio': float(info.get('å¸‚ç›ˆç‡-åŠ¨æ€', 0)),
            'pb_ratio': float(info.get('å¸‚å‡€ç‡', 0))
        }
    except Exception as e:
        print(f"è·å–è‚¡ç¥¨ä¿¡æ¯å¤±è´¥ {stock_code}: {e}")
        return {}
```

**æ›¿æ¢ç°æœ‰ä»£ç ï¼š**

```python
# åœ¨ backend/main.py ä¸­æ›¿æ¢ä»¥ä¸‹å‡½æ•°ï¼š

# æ›¿æ¢ get_margin_trading_info()
def get_margin_trading_info(code: str) -> Dict[str, Any]:
    """è·å–èèµ„èåˆ¸ä¿¡æ¯ï¼ˆä½¿ç”¨AKShareçœŸå®æ•°æ®ï¼‰"""
    return get_margin_trading_akshare(code)

# æ›¿æ¢ get_capital_flow()
def get_capital_flow(code: str) -> Dict[str, Any]:
    """è·å–èµ„é‡‘æµå‘ä¿¡æ¯ï¼ˆä½¿ç”¨AKShareçœŸå®æ•°æ®ï¼‰"""
    return get_capital_flow_akshare(code)

# æ›¿æ¢ generate_kline_data()
def generate_kline_data(code: str, price: float, change_percent: float) -> List[Dict[str, Any]]:
    """ç”ŸæˆKçº¿æ•°æ®ï¼ˆä½¿ç”¨AKShareçœŸå®æ•°æ®ï¼‰"""
    df = get_kline_data_akshare(code, period='daily')
    
    # å–æœ€è¿‘10å¤©
    df = df.tail(10)
    
    # è½¬æ¢ä¸ºåˆ—è¡¨
    kline = []
    for _, row in df.iterrows():
        kline.append({
            'date': row['date'].strftime('%Y-%m-%d'),
            'open': round(row['open'], 2),
            'close': round(row['close'], 2),
            'high': round(row['high'], 2),
            'low': round(row['low'], 2),
            'volume': int(row['volume'])
        })
    
    return kline
```

**AKShareå¸¸ç”¨æ¥å£ï¼š**

| åŠŸèƒ½ | æ¥å£ | è¯´æ˜ |
|------|------|------|
| å®æ—¶è¡Œæƒ… | `ak.stock_zh_a_spot_em()` | æ²ªæ·±Aè‚¡å®æ—¶è¡Œæƒ… |
| èèµ„èåˆ¸ | `ak.stock_margin_detail_sse()` | ä¸Šäº¤æ‰€èèµ„èåˆ¸æ˜ç»† |
| èµ„é‡‘æµå‘ | `ak.stock_individual_fund_flow_rank()` | ä¸ªè‚¡èµ„é‡‘æµå‘æ’å |
| æ—¥Kçº¿ | `ak.stock_zh_a_hist()` | ä¸ªè‚¡å†å²è¡Œæƒ…ï¼ˆæ—¥çº¿ï¼‰ |
| åˆ†é’ŸKçº¿ | `ak.stock_zh_a_hist_min_em()` | ä¸ªè‚¡åˆ†é’Ÿçº§åˆ«è¡Œæƒ… |
| è‚¡ç¥¨ä¿¡æ¯ | `ak.stock_individual_info_em()` | ä¸ªè‚¡åŸºæœ¬ä¿¡æ¯ |
| è´¢åŠ¡æ•°æ® | `ak.stock_financial_analysis_indicator()` | è´¢åŠ¡åˆ†ææŒ‡æ ‡ |

---

### æ–¹æ¡ˆäºŒï¼šæ–°æµªè´¢ç»APIï¼ˆå¤‡ç”¨ï¼‰â­â­â­â­

**ä¼˜åŠ¿ï¼š**
- âœ… å®Œå…¨å…è´¹
- âœ… å®æ—¶æ€§å¥½ï¼ˆå»¶è¿Ÿ3-5ç§’ï¼‰
- âœ… ç¨³å®šæ€§é«˜

**å¿«é€Ÿå¼€å§‹ï¼š**

```python
import requests
import re

def get_sina_realtime_quotes(stock_codes: List[str]) -> List[Dict]:
    """
    ä½¿ç”¨æ–°æµªè´¢ç»APIè·å–å®æ—¶è¡Œæƒ…ï¼ˆå…è´¹ï¼‰
    """
    # æ ¼å¼åŒ–è‚¡ç¥¨ä»£ç 
    formatted_codes = []
    for code in stock_codes:
        if code.startswith('6'):
            formatted_codes.append(f'sh{code}')
        else:
            formatted_codes.append(f'sz{code}')
    
    # è°ƒç”¨æ–°æµªAPI
    url = f"http://hq.sinajs.cn/list={','.join(formatted_codes)}"
    response = requests.get(url)
    response.encoding = 'gbk'
    
    results = []
    for line in response.text.strip().split('\n'):
        match = re.match(r'var hq_str_(\w+)="(.*)";', line)
        if match:
            data = match.group(2).split(',')
            if len(data) > 30:
                results.append({
                    'code': match.group(1).replace('sh', '').replace('sz', ''),
                    'name': data[0],
                    'price': float(data[3]),
                    'change_percent': ((float(data[3]) - float(data[2])) / float(data[2]) * 100) if float(data[2]) > 0 else 0,
                    'volume': float(data[8]),
                    'amount': float(data[9]),
                    'high': float(data[4]),
                    'low': float(data[5])
                })
    
    return results
```

---

## ğŸš€ ç¬¬äºŒä¼˜å…ˆçº§ï¼šå…è´¹æ€§èƒ½ä¼˜åŒ–

### 1. æœ¬åœ°ç¼“å­˜ï¼ˆæ— éœ€Redisï¼‰

```python
from functools import lru_cache
from datetime import datetime, timedelta
import pickle
import os

class LocalCache:
    """æœ¬åœ°æ–‡ä»¶ç¼“å­˜ï¼ˆå…è´¹ï¼‰"""
    
    def __init__(self, cache_dir: str = '.cache'):
        self.cache_dir = cache_dir
        os.makedirs(cache_dir, exist_ok=True)
    
    def get(self, key: str, ttl: int = 300) -> Any:
        """è·å–ç¼“å­˜"""
        cache_file = os.path.join(self.cache_dir, f"{key}.pkl")
        
        if not os.path.exists(cache_file):
            return None
        
        # æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        file_time = os.path.getmtime(cache_file)
        if time.time() - file_time > ttl:
            os.remove(cache_file)
            return None
        
        # è¯»å–ç¼“å­˜
        with open(cache_file, 'rb') as f:
            return pickle.load(f)
    
    def set(self, key: str, value: Any):
        """è®¾ç½®ç¼“å­˜"""
        cache_file = os.path.join(self.cache_dir, f"{key}.pkl")
        with open(cache_file, 'wb') as f:
            pickle.dump(value, f)
    
    def clear(self):
        """æ¸…ç©ºç¼“å­˜"""
        for file in os.listdir(self.cache_dir):
            os.remove(os.path.join(self.cache_dir, file))

# ä½¿ç”¨ç¤ºä¾‹
cache = LocalCache()

@lru_cache(maxsize=1000)  # å†…å­˜ç¼“å­˜
def get_stock_data_cached(stock_code: str):
    """å¸¦ç¼“å­˜çš„è‚¡ç¥¨æ•°æ®è·å–"""
    # å…ˆæŸ¥æœ¬åœ°ç¼“å­˜
    cached = cache.get(f"stock_{stock_code}", ttl=60)
    if cached:
        return cached
    
    # è·å–æ–°æ•°æ®
    data = get_stock_data(stock_code)
    
    # ä¿å­˜åˆ°ç¼“å­˜
    cache.set(f"stock_{stock_code}", data)
    
    return data
```

### 2. SQLiteæ•°æ®åº“ï¼ˆå…è´¹ï¼ŒPythonè‡ªå¸¦ï¼‰

```python
import sqlite3
from datetime import datetime

class StockDatabase:
    """SQLiteæ•°æ®åº“ï¼ˆå…è´¹ï¼Œæ— éœ€å®‰è£…ï¼‰"""
    
    def __init__(self, db_path: str = 'stock_data.db'):
        self.conn = sqlite3.connect(db_path)
        self.create_tables()
    
    def create_tables(self):
        """åˆ›å»ºè¡¨"""
        cursor = self.conn.cursor()
        
        # è‚¡ç¥¨åŸºç¡€ä¿¡æ¯è¡¨
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS stocks (
                code TEXT PRIMARY KEY,
                name TEXT,
                industry TEXT,
                market TEXT,
                is_margin_trading INTEGER,
                updated_at TIMESTAMP
            )
        ''')
        
        # æ—¥çº¿æ•°æ®è¡¨
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS daily_quotes (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                stock_code TEXT,
                trade_date DATE,
                open REAL,
                close REAL,
                high REAL,
                low REAL,
                volume INTEGER,
                amount REAL,
                updated_at TIMESTAMP,
                UNIQUE(stock_code, trade_date)
            )
        ''')
        
        # åˆ›å»ºç´¢å¼•
        cursor.execute('CREATE INDEX IF NOT EXISTS idx_stock_date ON daily_quotes(stock_code, trade_date)')
        
        self.conn.commit()
    
    def save_stock_info(self, stock_info: Dict):
        """ä¿å­˜è‚¡ç¥¨ä¿¡æ¯"""
        cursor = self.conn.cursor()
        cursor.execute('''
            INSERT OR REPLACE INTO stocks 
            (code, name, industry, market, is_margin_trading, updated_at)
            VALUES (?, ?, ?, ?, ?, ?)
        ''', (
            stock_info['code'],
            stock_info['name'],
            stock_info.get('industry', ''),
            stock_info.get('market', ''),
            stock_info.get('is_margin_trading', 0),
            datetime.now()
        ))
        self.conn.commit()
    
    def get_stock_info(self, stock_code: str) -> Dict:
        """è·å–è‚¡ç¥¨ä¿¡æ¯"""
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM stocks WHERE code = ?', (stock_code,))
        row = cursor.fetchone()
        
        if row:
            return {
                'code': row[0],
                'name': row[1],
                'industry': row[2],
                'market': row[3],
                'is_margin_trading': bool(row[4])
            }
        return None

# ä½¿ç”¨ç¤ºä¾‹
db = StockDatabase()

# ä¿å­˜æ•°æ®
db.save_stock_info({
    'code': '000001',
    'name': 'å¹³å®‰é“¶è¡Œ',
    'industry': 'é‡‘è',
    'is_margin_trading': True
})

# æŸ¥è¯¢æ•°æ®
info = db.get_stock_info('000001')
```

### 3. å¹¶è¡Œå¤„ç†ä¼˜åŒ–

```python
from concurrent.futures import ThreadPoolExecutor, ProcessPoolExecutor
import multiprocessing

def screen_stocks_parallel_free(stock_codes: List[str], strategy) -> List[Dict]:
    """
    å…è´¹å¹¶è¡Œç­›é€‰ï¼ˆä½¿ç”¨Pythonå†…ç½®çš„å¤šè¿›ç¨‹ï¼‰
    """
    # è·å–CPUæ ¸å¿ƒæ•°
    num_workers = multiprocessing.cpu_count()
    
    # åˆ†æ‰¹å¤„ç†
    batch_size = len(stock_codes) // num_workers
    batches = [stock_codes[i:i+batch_size] for i in range(0, len(stock_codes), batch_size)]
    
    # å¹¶è¡Œå¤„ç†
    with ProcessPoolExecutor(max_workers=num_workers) as executor:
        futures = [executor.submit(screen_batch, batch, strategy) for batch in batches]
        results = []
        for future in futures:
            results.extend(future.result())
    
    return results

def screen_batch(stock_codes: List[str], strategy) -> List[Dict]:
    """å¤„ç†ä¸€æ‰¹è‚¡ç¥¨"""
    results = []
    for code in stock_codes:
        # ç­›é€‰é€»è¾‘
        stock_data = get_stock_data(code)
        if strategy.match(stock_data):
            results.append(stock_data)
    return results
```

---

## ğŸ“± ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…è´¹ç§»åŠ¨ç«¯ä¼˜åŒ–

### PWAé…ç½®ï¼ˆå®Œå…¨å…è´¹ï¼‰

```json
// public/manifest.json
{
  "name": "Aè‚¡æ³¢æ®µäº¤æ˜“ç­›é€‰",
  "short_name": "æ³¢æ®µäº¤æ˜“",
  "description": "å…è´¹çš„Aè‚¡æ³¢æ®µäº¤æ˜“ç­›é€‰å·¥å…·",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#1890ff",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

```javascript
// public/sw.js - Service Worker
const CACHE_NAME = 'stock-screener-v1';

self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME).then((cache) => {
      return cache.addAll([
        '/',
        '/index.html',
        '/static/css/main.css',
        '/static/js/main.js'
      ]);
    })
  );
});

self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request).then((response) => {
      return response || fetch(event.request);
    })
  );
});
```

---

## ğŸ”” ç¬¬å››ä¼˜å…ˆçº§ï¼šå…è´¹æé†’åŠŸèƒ½

### æµè§ˆå™¨é€šçŸ¥ï¼ˆå®Œå…¨å…è´¹ï¼‰

```typescript
// å‰ç«¯æµè§ˆå™¨é€šçŸ¥
class BrowserNotifier {
  async requestPermission() {
    if ('Notification' in window) {
      const permission = await Notification.requestPermission();
      return permission === 'granted';
    }
    return false;
  }
  
  notify(title: string, options: NotificationOptions) {
    if (Notification.permission === 'granted') {
      new Notification(title, {
        body: options.body,
        icon: '/icon-192.png',
        badge: '/icon-192.png',
        tag: options.tag,
        requireInteraction: true
      });
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const notifier = new BrowserNotifier();

// è¯·æ±‚æƒé™
await notifier.requestPermission();

// å‘é€é€šçŸ¥
notifier.notify('ä»·æ ¼æé†’', {
  body: 'å¹³å®‰é“¶è¡Œ(000001)å·²è¾¾åˆ°ç›®æ ‡ä»·15.00å…ƒ',
  tag: 'price-alert-000001'
});
```

### åå°å®šæ—¶æ£€æŸ¥ï¼ˆå…è´¹ï¼‰

```python
import schedule
import time
from threading import Thread

def check_price_alerts():
    """æ£€æŸ¥ä»·æ ¼æé†’"""
    alerts = load_alerts()  # ä»æœ¬åœ°æ–‡ä»¶åŠ è½½æé†’è§„åˆ™
    
    for alert in alerts:
        current_price = get_current_price(alert['stock_code'])
        
        if alert['condition'] == 'above' and current_price >= alert['target_price']:
            send_browser_notification(alert)
        elif alert['condition'] == 'below' and current_price <= alert['target_price']:
            send_browser_notification(alert)

def run_scheduler():
    """è¿è¡Œå®šæ—¶ä»»åŠ¡"""
    schedule.every(1).minutes.do(check_price_alerts)
    
    while True:
        schedule.run_pending()
        time.sleep(1)

# åœ¨åå°çº¿ç¨‹è¿è¡Œ
Thread(target=run_scheduler, daemon=True).start()
```

---

## ğŸ“Š å®Œæ•´çš„å…è´¹æŠ€æœ¯æ ˆ

| åŠŸèƒ½ | å…è´¹æ–¹æ¡ˆ | è¯´æ˜ |
|------|---------|------|
| **æ•°æ®æº** | AKShare | å®Œå…¨å…è´¹ï¼Œæ•°æ®ä¸°å¯Œ |
| **å¤‡ç”¨æ•°æ®æº** | æ–°æµªè´¢ç»API | å…è´¹ï¼Œå®æ—¶æ€§å¥½ |
| **ç¼“å­˜** | æœ¬åœ°æ–‡ä»¶ç¼“å­˜ + LRU | Pythonå†…ç½®ï¼Œæ— éœ€å®‰è£… |
| **æ•°æ®åº“** | SQLite | Pythonè‡ªå¸¦ï¼Œæ— éœ€å®‰è£… |
| **å¹¶è¡Œå¤„ç†** | ProcessPoolExecutor | Pythonå†…ç½® |
| **ç§»åŠ¨ç«¯** | PWA | æµè§ˆå™¨åŸç”Ÿæ”¯æŒ |
| **é€šçŸ¥** | æµè§ˆå™¨é€šçŸ¥API | æµè§ˆå™¨åŸç”Ÿæ”¯æŒ |
| **å®šæ—¶ä»»åŠ¡** | scheduleåº“ | å…è´¹Pythonåº“ |
| **å‰ç«¯** | React + Vite | å¼€æºå…è´¹ |
| **åç«¯** | FastAPI | å¼€æºå…è´¹ |

---

## ğŸ¯ å®æ–½æ­¥éª¤ï¼ˆé›¶æˆæœ¬ï¼‰

### ç¬¬1æ­¥ï¼šå®‰è£…å…è´¹ä¾èµ–ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# å®‰è£…AKShare
pip install akshare

# å®‰è£…å®šæ—¶ä»»åŠ¡åº“
pip install schedule

# å…¶ä»–éƒ½æ˜¯Pythonå†…ç½®çš„ï¼Œæ— éœ€å®‰è£…
```

### ç¬¬2æ­¥ï¼šæ›¿æ¢æ•°æ®æºï¼ˆ30åˆ†é’Ÿï¼‰

```python
# åœ¨ backend/main.py ä¸­ï¼š

# 1. å¯¼å…¥AKShare
import akshare as ak

# 2. æ›¿æ¢èèµ„èåˆ¸å‡½æ•°
def get_margin_trading_info(code: str) -> Dict[str, Any]:
    return get_margin_trading_akshare(code)

# 3. æ›¿æ¢èµ„é‡‘æµå‘å‡½æ•°
def get_capital_flow(code: str) -> Dict[str, Any]:
    return get_capital_flow_akshare(code)

# 4. æ›¿æ¢Kçº¿æ•°æ®å‡½æ•°
def generate_kline_data(code: str, price: float, change_percent: float) -> List[Dict[str, Any]]:
    return get_kline_data_akshare(code)
```

### ç¬¬3æ­¥ï¼šæ·»åŠ æœ¬åœ°ç¼“å­˜ï¼ˆ20åˆ†é’Ÿï¼‰

```python
# åˆ›å»ºç¼“å­˜å®ä¾‹
cache = LocalCache(cache_dir='.cache')

# åœ¨æ•°æ®è·å–å‡½æ•°ä¸­æ·»åŠ ç¼“å­˜
def get_all_stocks_data(use_cache: bool = True) -> List[Dict[str, Any]]:
    if use_cache:
        cached = cache.get('all_stocks', ttl=60)
        if cached:
            return cached
    
    # è·å–æ–°æ•°æ®
    data = fetch_new_data()
    
    # ä¿å­˜åˆ°ç¼“å­˜
    cache.set('all_stocks', data)
    
    return data
```

### ç¬¬4æ­¥ï¼šå¯ç”¨PWAï¼ˆ10åˆ†é’Ÿï¼‰

```bash
# 1. åœ¨ frontend/public/ åˆ›å»º manifest.json
# 2. åœ¨ frontend/public/ åˆ›å»º sw.js
# 3. åœ¨ frontend/index.html ä¸­å¼•ç”¨
<link rel="manifest" href="/manifest.json">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js');
  }
</script>
```

---

## ğŸ’¡ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | å½“å‰ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰ | å…è´¹æ–¹æ¡ˆï¼ˆçœŸå®æ•°æ®ï¼‰ | æå‡ |
|------|----------------|-------------------|------|
| æ•°æ®å‡†ç¡®æ€§ | âŒ æ¨¡æ‹Ÿ | âœ… çœŸå® | 100% |
| ç­›é€‰é€Ÿåº¦ | 23-25ç§’ | 12-15ç§’ | 40% |
| ç¼“å­˜å‘½ä¸­ç‡ | 0% | 70%+ | +70% |
| ç§»åŠ¨ç«¯æ”¯æŒ | âš ï¸ ä¸€èˆ¬ | âœ… PWA | æ˜¾è‘—æå‡ |
| æ€»æˆæœ¬ | 0å…ƒ | 0å…ƒ | æŒå¹³ |

---

## âœ… æ€»ç»“

### å®Œå…¨å…è´¹çš„ä¼˜åŒ–æ–¹æ¡ˆï¼š

1. **æ•°æ®æº**ï¼šAKShareï¼ˆå…è´¹ï¼‰ + æ–°æµªAPIï¼ˆå¤‡ç”¨ï¼‰
2. **ç¼“å­˜**ï¼šæœ¬åœ°æ–‡ä»¶ç¼“å­˜ + LRUå†…å­˜ç¼“å­˜
3. **æ•°æ®åº“**ï¼šSQLiteï¼ˆPythonè‡ªå¸¦ï¼‰
4. **å¹¶è¡Œ**ï¼šProcessPoolExecutorï¼ˆPythonå†…ç½®ï¼‰
5. **ç§»åŠ¨ç«¯**ï¼šPWAï¼ˆæµè§ˆå™¨åŸç”Ÿï¼‰
6. **é€šçŸ¥**ï¼šæµè§ˆå™¨é€šçŸ¥APIï¼ˆå…è´¹ï¼‰

### é¢„æœŸæ•ˆæœï¼š

- âœ… æ•°æ®ä»æ¨¡æ‹Ÿå˜ä¸ºçœŸå®
- âœ… ç­›é€‰é€Ÿåº¦æå‡40%
- âœ… æ”¯æŒç§»åŠ¨ç«¯PWA
- âœ… æ”¯æŒæµè§ˆå™¨é€šçŸ¥
- âœ… **æ€»æˆæœ¬ï¼š0å…ƒ**

### ç«‹å³å¼€å§‹ï¼š

```bash
# 1. å®‰è£…AKShare
pip install akshare schedule

# 2. æµ‹è¯•æ•°æ®è·å–
python -c "import akshare as ak; print(ak.stock_zh_a_spot_em().head())"

# 3. å¼€å§‹æ›¿æ¢ä»£ç 
# å‚è€ƒä¸Šé¢çš„ä»£ç ç¤ºä¾‹
```

**å®Œå…¨å…è´¹ï¼Œç«‹å³å¯ç”¨ï¼** ğŸ‰
