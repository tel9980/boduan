# v4.15.4 快速使用指南

## 🚀 极速启动（推荐）

### 一键启动
```bash
# 双击运行这个文件
启动系统_极速版.bat
```

**启动流程**:
1. ✅ 启动后端服务（5秒）
2. ✅ 启动前端服务（5秒）
3. ⏳ 预热缓存（10-12分钟）- **首次必须等待**
4. ✅ 启动自动刷新服务

**首次预热后**:
- 前端: http://localhost:5173
- 后端: http://localhost:8000
- 点击任何策略按钮都能**秒开**（<1秒）
- 缓存每5分钟自动刷新

---

## 📊 性能对比

### 使用极速版启动
| 场景 | 响应时间 |
|------|---------|
| 首次点击 | <1秒 ⚡ |
| 30分钟内再次点击 | <1秒 ⚡ |
| 30分钟后再次点击 | <1秒 ⚡ |

### 不使用预热（传统方式）
| 场景 | 响应时间 |
|------|---------|
| 首次点击 | 2.5-3.5分钟 🐌 |
| 30分钟内再次点击 | <1秒 ⚡ |
| 30分钟后再次点击 | 2.5-3.5分钟 🐌 |

**结论**: 使用极速版启动，体验提升**200倍+**！

---

## 🎯 使用步骤

### Step 1: 启动系统
```bash
# 双击运行
启动系统_极速版.bat
```

### Step 2: 等待预热（首次必须）
```
[1/4] 启动后端服务... ✅
[2/4] 启动前端服务... ✅
[3/4] 预热缓存...
      ⏳ 正在生成平衡型缓存...
      ⏳ 正在生成激进型缓存...
      ⏳ 正在生成保守型缓存...
      ✅ 缓存预热完成！
[4/4] 启动自动刷新服务... ✅
```

**预热时间**: 约10-12分钟（只需首次等待）

### Step 3: 开始使用
1. 打开浏览器: http://localhost:5173
2. 点击任意策略按钮（激进型/保守型/平衡型）
3. **秒开**，查看推荐股票

---

## 💡 优化详情

### 1. 数据获取速度提升
- **并发数**: 20 → 30
- **耗时**: 32秒 → 27秒
- **提升**: 15%

### 2. 详细分析速度提升
- **分析数量**: 80只 → 50只
- **耗时**: 90-120秒 → 60-80秒
- **提升**: 30%

### 3. 总体性能提升
- **v4.15.2**: 5-6分钟
- **v4.15.3**: 3-4分钟
- **v4.15.4**: 2.5-3.5分钟
- **v4.15.4 + 预热**: <1秒 ⚡⚡⚡

### 4. AI并发控制
- **并发限制**: 严格控制在1
- **间隔时间**: 1.2秒
- **线程安全**: ✅

---

## ⚠️ 重要提示

### 首次使用必须预热
❗ **首次启动必须等待10-12分钟完成预热**
- 预热会生成三种策略的缓存
- 预热完成后，任何时候点击都能秒开
- 只需首次等待，之后永久享受极速体验

### 保持自动刷新服务运行
✅ **自动刷新服务会每30分钟更新缓存**
- 确保缓存始终新鲜
- 用户无需等待
- 不要关闭"自动预热服务"窗口

### AI并发限制
⚠️ **GLM-4-Flash API 并发限制为1**
- 已通过线程锁严格控制
- 不要修改相关代码
- 如遇到API错误，请检查并发设置

---

## 🔧 手动启动（高级用户）

如果你想手动控制各个服务：

```bash
# 1. 启动后端
python backend/main.py

# 2. 启动前端（新窗口）
cd frontend
npm run dev

# 3. 预热缓存（可选，但强烈推荐）
python preheat_cache.py

# 4. 启动自动刷新（可选）
python backend/auto_preheat.py
```

---

## 📈 性能监控

### 查看后端日志
后端窗口会显示详细日志：
```
🔄 获取最新股票数据...
✅ 数据获取完成：4909只股票，耗时27.5秒

🔍 第一阶段：快速过滤...
   快速过滤完成：4909 → 162 只
   ⚡ 性能优化：限制详细分析数量 162 → 50 只

🔍 第二阶段：详细分析...
   详细分析完成：50 → 45 只

🤖 正在生成 AI 智能分析...
   分析中: 1/3 - 浙江医药
   ⏳ 并发控制：等待 1.2秒...
   分析中: 2/3 - 华东医药
   ⏳ 并发控制：等待 1.2秒...
   分析中: 3/3 - 恒瑞医药
✅ AI 分析完成

✅ 筛选完成
   • 总扫描: 4909只
   • 详细分析: 50只
   • 最终入选: 3只
   • 总耗时: 2分38秒
```

### 关键指标
- **数据获取**: 应该在25-30秒
- **详细分析**: 应该只分析50只
- **AI并发控制**: 应该看到"等待1.2秒"
- **总耗时**: 应该在2.5-3.5分钟

---

## 🎉 使用技巧

### 技巧1: 首次启动后不要关闭
- 保持所有服务窗口运行
- 自动刷新服务会每30分钟更新缓存
- 你可以最小化窗口，但不要关闭

### 技巧2: 查看缓存状态
```bash
# 查看缓存文件
dir backend\cache

# 应该看到三个缓存文件
cache_aggressive_*.json  # 激进型
cache_conservative_*.json  # 保守型
cache_balanced_*.json  # 平衡型
```

### 技巧3: 清空缓存（如需重新筛选）
```bash
# 方式1: 访问API
http://localhost:8000/api/cache/clear

# 方式2: 删除缓存文件
del backend\cache\*.json
```

### 技巧4: 查看市场环境
```bash
# 访问市场环境API
http://localhost:8000/api/market-environment
```

---

## 🐛 常见问题

### Q1: 首次启动为什么要等10-12分钟？
**A**: 需要预热三种策略的缓存
- 每个策略需要3-4分钟
- 三个策略共10-12分钟
- 只需首次等待，之后永久享受极速体验

### Q2: 预热完成后还会慢吗？
**A**: 不会！
- 预热完成后，任何时候点击都能秒开
- 自动刷新服务会每5分钟更新缓存
- 用户永远不需要等待

### Q3: 如果关闭了自动刷新服务怎么办？
**A**: 重新启动即可
```bash
python backend/auto_preheat.py
```

### Q4: AI分析为什么这么慢？
**A**: GLM-4-Flash API 有并发限制
- 并发限制为1
- 每次调用至少间隔1.2秒
- 3只股票需要约4-5秒
- 这是API限制，无法优化

### Q5: 可以跳过预热吗？
**A**: 可以，但不推荐
- 跳过预热，首次点击需要等待2.5-3.5分钟
- 30分钟后再次点击又需要等待
- 强烈建议首次预热，之后永久享受极速体验

---

## 📞 技术支持

### 查看日志
- 后端日志: 后端服务窗口
- 前端日志: 浏览器控制台（F12）
- 自动刷新日志: 自动预热服务窗口

### 报告问题
如遇到问题，请提供：
1. 错误信息截图
2. 后端日志
3. 操作步骤

---

## 🎊 总结

### 使用极速版启动的好处
1. ✅ **秒开**: 任何时候点击都能<1秒响应
2. ✅ **自动刷新**: 缓存每30分钟自动更新
3. ✅ **一键启动**: 无需手动操作
4. ✅ **AI安全**: 严格控制并发，稳定可靠

### 性能提升
- 首次筛选: 5-6分钟 → 2.5-3.5分钟（40%提升）
- 用户体验: 3-4分钟 → <1秒（200倍+提升）
- 数据获取: 41.7秒 → 27秒（35%提升）
- 详细分析: 162只 → 50只（69%减少）

### 开始使用
```bash
# 双击运行
启动系统_极速版.bat

# 等待10-12分钟预热
# 然后享受极速体验！
```

---

**版本**: v4.15.4  
**更新时间**: 2026-02-08  
**推荐启动方式**: 启动系统_极速版.bat  
**用户体验**: ⚡⚡⚡ 极速秒开
