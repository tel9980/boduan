<!DOCTYPE html>
<html>
<head>
    <title>APIæµ‹è¯•</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        #result { margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Aè‚¡ç­›é€‰ç³»ç»Ÿ - APIæµ‹è¯•</h1>
    
    <button onclick="testAPI()">æµ‹è¯•API</button>
    <button onclick="testBalanced()">æµ‹è¯•å¹³è¡¡å‹</button>
    <button onclick="testAggressive()">æµ‹è¯•æ¿€è¿›å‹</button>
    <button onclick="testConservative()">æµ‹è¯•ä¿å®ˆå‹</button>
    
    <div id="result"></div>
    
    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'â³ æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch('http://localhost:8000/api/band-trading-realtime?strategy_type=balanced&limit=3');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>âœ… APIæµ‹è¯•æˆåŠŸ</h3>
                            <p><strong>è¿”å›è‚¡ç¥¨æ•°é‡ï¼š</strong>${data.count}</p>
                            <p><strong>ç¼“å­˜å¹´é¾„ï¼š</strong>${data.cache_age_minutes || 'N/A'}åˆ†é’Ÿ</p>
                            <p><strong>æç¤ºä¿¡æ¯ï¼š</strong>${data.message || 'N/A'}</p>
                            <h4>æ¨èè‚¡ç¥¨ï¼š</h4>
                            <ul>
                                ${data.data.map(stock => `
                                    <li>
                                        <strong>${stock.name}(${stock.code})</strong> - 
                                        æ¶¨å¹…:${stock.change_percent.toFixed(2)}% | 
                                        é‡æ¯”:${stock.volume_ratio.toFixed(1)} | 
                                        è¯„åˆ†:${stock.score}
                                        ${stock.ai_analysis ? '<br>ğŸ¤– AI: ' + stock.ai_analysis.substring(0, 100) + '...' : ''}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ APIé”™è¯¯: ${response.status} - ${data.detail || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testBalanced() {
            await testStrategy('balanced', 'å¹³è¡¡å‹');
        }
        
        async function testAggressive() {
            await testStrategy('aggressive', 'æ¿€è¿›å‹');
        }
        
        async function testConservative() {
            await testStrategy('conservative', 'ä¿å®ˆå‹');
        }
        
        async function testStrategy(type, name) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `â³ æµ‹è¯•${name}ç­–ç•¥...`;
            
            try {
                const response = await fetch(`http://localhost:8000/api/band-trading-realtime?strategy_type=${type}&limit=3`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>âœ… ${name}ç­–ç•¥æµ‹è¯•æˆåŠŸ</h3>
                            <p><strong>è¿”å›è‚¡ç¥¨æ•°é‡ï¼š</strong>${data.count}</p>
                            <p><strong>ç¼“å­˜å¹´é¾„ï¼š</strong>${data.cache_age_minutes || 'N/A'}åˆ†é’Ÿ</p>
                            <h4>æ¨èè‚¡ç¥¨ï¼š</h4>
                            <ol>
                                ${data.data.map(stock => `
                                    <li>
                                        <strong>${stock.name}(${stock.code})</strong><br>
                                        æ¶¨å¹…:${stock.change_percent.toFixed(2)}% | 
                                        é‡æ¯”:${stock.volume_ratio.toFixed(1)} | 
                                        è¯„åˆ†:${stock.score}<br>
                                        ${stock.ai_analysis ? 'ğŸ¤– ' + stock.ai_analysis : ''}
                                    </li>
                                `).join('')}
                            </ol>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ APIé”™è¯¯: ${response.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
