# 🎯 A股波段交易筛选系统 - 配置总结

## ✅ 已完成的优化

### 1. 核心策略调整

| 项目 | 优化前 | 优化后 | 说明 |
|------|--------|--------|------|
| **板块范围** | 全市场 | 主板+创业板 | 排除科创板，降低风险 |
| **融资融券** | 可选 | **必须** | 机构参与度高，流动性好 |
| **ST股票** | 可选排除 | **强制排除** | 严格风控 |
| **亏损股** | 未检测 | **强制排除** | 避免地雷股 |
| **市值上限** | 300亿 | **160亿** | 专注中小市值成长股 |
| **涨幅范围** | 2%-6% | **-2%~5%** | 不追涨，寻找波段买点 |
| **持仓限制** | 无限制 | **最多3只** | 分散风险，集中优势 |

### 2. 评分体系优化

**融资融券权重提升至40%**
- 融资融券评分 ≥70：+28分
- 融资净流入 >0.05亿：+15分
- 不支持融资融券：-30分（大幅减分）

**波段交易偏好**
- 回调到位（-2%~0%）：+20分 ⭐最佳买点
- 温和上涨（0%~3%）：+15分
- 涨幅过大（>7%）：-20分（避免追高）

**市值偏好调整**
- 50-100亿：+15分（最佳）
- 100-160亿：+10分
- >160亿：-20分（超限）

### 3. 风控机制强化

**强制排除规则：**
```python
✅ 科创板（688xxx）- 始终排除
✅ ST股票（*ST、ST、S开头）- 强制排除
✅ 亏损股票 - 强制排除
✅ 非融资融券标的 - 强制排除
✅ 市值>160亿 - 强制排除
✅ 涨幅>7% - 避免追高
```

**持仓限制：**
```python
MAX_POSITIONS = 3  # 最多3只个股
```

---

## 📊 系统架构

### 后端（backend/main.py）

```python
# 核心配置
BAND_TRADING_CONFIG = {
    "max_positions": 3,           # 最大持仓
    "max_market_cap": 160,        # 市值上限
    "require_margin": True,       # 必须融资融券
    "exclude_st": True,           # 排除ST
    "exclude_loss": True,         # 排除亏损
    "change_range": (-2, 5),      # 涨跌幅范围
    "volume_ratio_range": (1.5, 3.0),
    "boards": ["main", "cyb"],    # 主板+创业板
}
```

### 前端（frontend/src/App.tsx）

```typescript
// 默认配置
const [filterConfig, setFilterConfig] = useState<FilterConfig>({
    changeMin: -2,              // 允许回调
    changeMax: 5,               // 不追涨
    volumeRatioMin: 1.5,
    volumeRatioMax: 3,
    marketCapMin: 50,
    marketCapMax: 160,          // 市值上限160亿
    includeKcbCyb: true,        // 包含创业板
    requireMargin: true,        // 必须融资融券
    preferTailInflow: true,
    strictRiskControl: true,
    isBandTradingMode: true,    // 波段交易模式
});
```

---

## 🚀 API接口

### 1. 波段交易筛选（主接口）

**端点：** `GET /api/band-trading`

**参数：**
```
change_min: -2.0        # 涨幅下限
change_max: 5.0         # 涨幅上限
volume_ratio_min: 1.5   # 量比下限
volume_ratio_max: 3.0   # 量比上限
market_cap_max: 160     # 市值上限（亿）
limit: 3                # 返回数量（最多3只）
```

**返回示例：**
```json
{
  "success": true,
  "count": 3,
  "data": [
    {
      "code": "000001",
      "name": "平安银行",
      "price": 12.34,
      "change_percent": 2.5,
      "market_cap": 120,
      "score": 75.5,
      "reasons": [
        "💎 融资融券强势(评分72)",
        "💰 融资净流入0.08亿",
        "📈 温和上涨(2.5%)，趋势良好"
      ],
      "warnings": [],
      "risk_level": "low",
      "margin_info": {
        "is_margin_eligible": true,
        "margin_balance": 2.5,
        "margin_score": 72,
        "net_flow": 0.08
      },
      "capital_flow": {
        "main_inflow": 0.5,
        "is_inflow": true,
        "flow_strength": "weak_in"
      },
      "board_type": {
        "type": "sz",
        "name": "深市主板",
        "allowed": true
      }
    }
  ],
  "strategy": {
    "name": "波段交易",
    "max_positions": 3,
    "description": "主板+创业板融资融券标的，严格风控"
  },
  "statistics": {
    "total_scanned": 5000,
    "excluded": {
      "kcb": 500,
      "st": 200,
      "loss": 50,
      "no_margin": 2000,
      "market_cap": 800,
      "board": 100,
      "criteria": 1347
    },
    "final_selected": 3
  }
}
```

### 2. 通用筛选（兼容接口）

**端点：** `GET /api/screen`

自动调用波段交易筛选，参数同上。

### 3. 实时行情

**端点：** `GET /api/realtime?code=000001`

---

## 📈 使用流程

### 1. 启动系统

**方式一：使用启动脚本**
```bash
双击运行：启动系统.bat
```

**方式二：手动启动**
```bash
# 终端1：启动后端
python backend/main.py

# 终端2：启动前端
cd frontend
npm run dev
```

### 2. 访问界面

- 前端界面：http://localhost:5173
- API文档：http://localhost:8000/docs

### 3. 筛选股票

1. 点击"开始筛选"按钮
2. 系统自动筛选符合条件的股票
3. 最多返回3只推荐股票
4. 查看详细分析和评分

### 4. 分析结果

每只股票显示：
- ✅ 综合评分（0-100分）
- ✅ 推荐理由（3-5条）
- ✅ 风险提示
- ✅ 融资融券信息
- ✅ 资金流向
- ✅ 板块类型
- ✅ AI雷达图（6维度）

---

## ⚙️ 配置文件位置

### 后端配置
- **主文件**：`backend/main.py`
- **策略配置**：`BAND_TRADING_CONFIG`（第40行）
- **评分算法**：`calculate_band_trading_score()`（第200行）

### 前端配置
- **主文件**：`frontend/src/App.tsx`
- **默认配置**：`filterConfig`（第30行）
- **API调用**：`frontend/src/api/stock.ts`

---

## 🔧 自定义配置

### 修改市值上限

**后端：**
```python
# backend/main.py 第43行
"max_market_cap": 160,  # 改为你想要的值
```

**前端：**
```typescript
// frontend/src/App.tsx 第36行
marketCapMax: 160,  // 改为你想要的值
```

### 修改持仓数量

**后端：**
```python
# backend/main.py 第40行
"max_positions": 3,  # 改为你想要的值（建议≤5）
```

### 修改涨幅范围

**后端：**
```python
# backend/main.py 第47行
"change_range": (-2, 5),  # (下限, 上限)
```

**前端：**
```typescript
// frontend/src/App.tsx 第31-32行
changeMin: -2,  // 下限
changeMax: 5,   // 上限
```

---

## 📊 性能优化

### 数据获取
- 并行获取股票数据（10线程）
- 批量处理（每批80只）
- 预计扫描5000只股票耗时：30-60秒

### 筛选效率
- 多级过滤，逐步筛选
- 评分≥50分才进入候选
- 最终按评分排序取Top 3

---

## ⚠️ 注意事项

### 1. 数据源
- 使用腾讯股票API
- 实时数据，延迟约3-5秒
- 融资融券数据为模拟数据（基于代码生成）

### 2. 风险提示
- 本系统仅供参考，不构成投资建议
- 股市有风险，投资需谨慎
- 建议结合其他分析工具综合判断

### 3. 使用建议
- 每天筛选1-2次即可
- 关注评分≥70分的股票
- 优先选择回调到位的标的
- 严格执行止盈止损

---

## 📞 技术支持

### 常见问题

**Q1: 为什么筛选结果少于3只？**
A: 可能当前市场符合条件的股票较少，可以适当放宽条件。

**Q2: 融资融券数据准确吗？**
A: 当前为模拟数据，建议结合实际融资融券数据使用。

**Q3: 如何获取真实融资融券数据？**
A: 可以对接东方财富或同花顺API，需要申请接口权限。

**Q4: 系统支持哪些浏览器？**
A: Chrome、Edge、Firefox等现代浏览器。

---

## 🎉 总结

✅ **已完成优化：**
1. 专注主板+创业板
2. 强制融资融券标的
3. 排除ST和亏损股
4. 市值上限160亿
5. 涨幅范围-2%~5%（不追涨）
6. 最多3只持仓限制
7. 智能评分体系
8. 波段交易策略

✅ **系统特点：**
- 🎯 策略清晰，风控严格
- 📊 评分科学，多维度分析
- 💰 专注融资融券标的
- 🚀 界面友好，操作简单
- ⚡ 性能优化，响应快速

**开始使用，祝投资顺利！** 📈💰
